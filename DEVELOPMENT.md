# Development Guide

This guide provides information for developers working on the Release Note Generator Action.

## Project Structure

```
release-note-action/
├── .github/
│   ├── workflows/
│   │   └── ci.yml                    # CI pipeline
│   └── pull_request_template.md      # PR template for contributors
├── examples/
│   ├── basic-workflow.yml            # Example without AI summary
│   ├── ai-summary-workflow.yml       # Example with AI summary
│   ├── pr-template.md                # Suggested PR body template
│   └── sample-output.json            # Example output
├── src/
│   ├── index.ts                      # Main entrypoint
│   ├── types.ts                      # TypeScript type definitions
│   ├── parser.ts                     # PR parsing and label normalization
│   └── summarizer.ts                 # AI summarization logic
├── dist/                             # Compiled output (committed to repo)
│   └── index.js                      # Bundled action (generated by ncc)
├── action.yml                        # GitHub Action metadata
├── package.json                      # Node.js dependencies
├── tsconfig.json                     # TypeScript configuration
├── .eslintrc.json                    # ESLint configuration
├── .prettierrc.json                  # Prettier configuration
├── .gitignore                        # Git ignore rules
├── LICENSE                           # MIT license
├── README.md                         # User-facing documentation
├── CONTRIBUTING.md                   # Contribution guidelines
└── DEVELOPMENT.md                    # This file
```

## Building the Action

The action uses `@vercel/ncc` to compile TypeScript and bundle all dependencies into a single `dist/index.js` file.

```bash
npm run build
```

This creates:
- `dist/index.js` - The bundled action code
- `dist/index.js.map` - Source map for debugging
- `dist/licenses.txt` - Bundled dependency licenses

**Important**: The `dist/` folder must be committed to the repository. GitHub Actions run the compiled code directly.

## Local Development

### Setup

```bash
npm install
```

### Linting

```bash
npm run lint
```

### Formatting

```bash
npm run format
```

### Type Checking

TypeScript will check types during the build process. You can also use your IDE's TypeScript integration.

## Testing

### Manual Testing with Act

[act](https://github.com/nektos/act) allows you to run GitHub Actions locally.

1. Install act:
   ```bash
   brew install act  # macOS
   # or see https://github.com/nektos/act for other platforms
   ```

2. Create a test event file (`test-event.json`):
   ```json
   {
     "action": "closed",
     "pull_request": {
       "number": 123,
       "title": "Test PR",
       "body": "## What was done\n- Test change",
       "labels": [{"name": "feature"}],
       "merged": true,
       "merged_at": "2024-01-15T10:30:00Z",
       "html_url": "https://github.com/owner/repo/pull/123",
       "base": {"ref": "main"},
       "user": {"login": "testuser"}
     }
   }
   ```

3. Run the action:
   ```bash
   act pull_request --eventpath test-event.json --secret GITHUB_TOKEN=your_token
   ```

### Testing in a Real Repository

1. Fork this repository
2. Create a test workflow in your fork
3. Create and merge test PRs to trigger the action
4. Check the Actions tab for results

## Code Organization

### index.ts

Main entrypoint that:
1. Reads action inputs
2. Validates the PR event
3. Fetches PR data from GitHub API
4. Orchestrates parsing and summarization
5. Sets the action output

### types.ts

TypeScript interfaces for:
- `PullRequestData` - Raw PR data from GitHub API
- `ParsedPRBody` - Structured sections from PR body
- `GeneratedSummary` - AI-generated content
- `ReleaseNote` - Final output schema
- `ActionInputs` - Action configuration

### parser.ts

Functions for:
- `parsePRBody()` - Extract structured sections from PR markdown
- `normalizeTags()` - Convert GitHub labels to high-level tags
- `extractAuthors()` - Collect all PR authors
- `extractChangesFromParsedBody()` - Extract bullet points

### summarizer.ts

Functions for:
- `generateSummary()` - Call Anthropic API for AI summary
- `createFallbackSummary()` - Generate summary without AI
- `buildSummarizationPrompt()` - Create prompt for AI
- `callAnthropicAPI()` - HTTP call to Anthropic
- `parseAIResponse()` - Parse JSON from AI response

## Dependencies

### Production Dependencies

- `@actions/core` - GitHub Actions toolkit for inputs/outputs/logging
- `@actions/github` - GitHub API client and context

### Development Dependencies

- `typescript` - TypeScript compiler
- `@vercel/ncc` - Bundler for GitHub Actions
- `@typescript-eslint/*` - TypeScript linting
- `prettier` - Code formatting
- `eslint` - Code linting

## Release Process

1. Update version in `package.json`
2. Create a new tag:
   ```bash
   git tag -a v1.0.0 -m "Release v1.0.0"
   git push origin v1.0.0
   ```
3. Create a GitHub release from the tag
4. Users can reference the action:
   ```yaml
   uses: gorilli-team/release-note-ai@v1.0.0
   ```

## Common Issues

### Build artifacts out of sync

If CI fails with "Build artifacts are out of sync":
```bash
npm run build
git add dist/
git commit -m "Update build artifacts"
```

### TypeScript errors

Run the TypeScript compiler directly to see detailed errors:
```bash
npx tsc --noEmit
```

### API rate limits

When testing, be aware of GitHub API rate limits. Use a personal access token for higher limits.

## Best Practices

1. **Always build before committing** - Run `npm run build` and commit `dist/`
2. **Test with real PRs** - Manual testing is important for GitHub Actions
3. **Handle missing data gracefully** - PRs may have empty bodies or unusual formats
4. **Preserve raw data** - Always include original PR data in output
5. **Keep it generic** - No company-specific logic or hardcoded values

## Resources

- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [GitHub Actions Toolkit](https://github.com/actions/toolkit)
- [Anthropic API Documentation](https://docs.anthropic.com/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
